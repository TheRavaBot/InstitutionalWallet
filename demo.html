<!DOCTYPE html>
<html>
<head>
  <title>User Transactions</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 8px 12px;
      border: 1px solid #ddd;
    }
    th {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>

<h2>User Transaction History</h2>

<table id="transactionsTable">
  <thead>
    <tr>
      <th>Date</th>
      <th>Amount</th>
      <th>Naira Equivalent</th>
      <th>Type</th>
    </tr>
  </thead>
  <tbody>
    <!-- Transactions will be inserted here -->
  </tbody>
</table>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
  // Your Firebase config
  var firebaseConfig = {
    apiKey: "AIzaSyAmhaIhOWWlPYceSdtJScVIIuZP0Rb71hM",
    authDomain: "project-iot-51262.firebaseapp.com",
    databaseURL: "https://project-iot-51262-default-rtdb.firebaseio.com",
    projectId: "project-iot-51262",
    storageBucket: "project-iot-51262.appspot.com",
    messagingSenderId: "785303672386",
    appId: "1:785303672386:web:8fb1aaac3c34e72e87bfdb"
  };
  firebase.initializeApp(firebaseConfig);

  const userId = "1"; // Replace with the actual logged-in user's ID

  function filterTransactionsByUser(allTransactions, targetUserId) {
    const userTransactions = [];

    Object.keys(allTransactions).forEach(userKey => {
      const transactionGroup = allTransactions[userKey];
      Object.keys(transactionGroup).forEach(txnKey => {
        const txn = transactionGroup[txnKey];
        if (txn?.user_id === targetUserId) {
          userTransactions.push({
            id: txnKey,
            ...txn
          });
        }
      });
    });

    return userTransactions;
  }

  function displayTransactions(transactions) {
    const tableBody = document.getElementById("transactionsTable").getElementsByTagName("tbody")[0];
    tableBody.innerHTML = ""; // Clear previous rows

    transactions.forEach(txn => {
      const row = tableBody.insertRow();
      row.innerHTML = `
        <td>${new Date(txn.date).toLocaleString()}</td>
        <td>${txn.amount}</td>
        <td>${txn.naira_equivalent || 'N/A'}</td>
        <td>${txn.type}</td>
      `;
    });
  }

  firebase.database().ref("unilorin-ict/transactions").once("value").then(snapshot => {
    const allTransactions = snapshot.val();
    const transactionsForUser = filterTransactionsByUser(allTransactions, userId);
    displayTransactions(transactionsForUser);
  });
</script>

</body>
</html>
